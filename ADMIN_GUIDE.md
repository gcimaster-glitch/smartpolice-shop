# 👨‍💼 管理者ガイド

スマートポリスECショップ - 管理画面使い方マニュアル

---

## 📌 目次

- [ログイン](#ログイン)
- [ダッシュボード](#ダッシュボード)
- [商品管理](#商品管理)
- [注文管理](#注文管理)
- [よくある質問](#よくある質問)

---

## ログイン

### 管理画面へのアクセス

**URL**: https://shop.smartpolice.net/admin/login.html

### 初期ログイン情報

```
メールアドレス: admin@smartpolice.net
パスワード: admin123
```

⚠️ **セキュリティ警告**: 初回ログイン後、必ずパスワードを変更してください！

---

## ダッシュボード

ログイン後、ダッシュボードが表示されます。

### 表示される情報

- **今月の売上**: 当月の注文合計金額
- **今月の注文数**: 当月の注文件数
- **在庫商品数**: 販売中の商品数
- **最近の注文**: 直近の注文一覧

---

## 商品管理

### 商品一覧を見る

1. サイドメニュー → **商品管理** をクリック
2. 全商品が一覧表示されます

### 商品を追加する

1. **新規商品追加** ボタンをクリック
2. 以下の情報を入力：

| 項目 | 必須 | 説明 |
|------|------|------|
| 商品名 | ✅ | 商品の名称 |
| 説明 | ✅ | 商品の詳細説明 |
| 価格 | ✅ | 販売価格（円） |
| カテゴリー | ✅ | 「個人向け」「スマートホーム」「車両・バイク」から選択 |
| Alibaba URL | | 仕入れ元のURL |
| Alibaba価格 | | 仕入れ価格（参考用） |
| 在庫ステータス | ✅ | 「在庫あり」「在庫切れ」から選択 |
| 商品画像 | | 画像ファイルをアップロード |
| 仕様 | | JSON形式で商品スペックを入力 |

**仕様の入力例**:
```json
{
  "resolution": "1080p",
  "wifi": "2.4GHz/5GHz",
  "night_vision": true
}
```

3. **保存** ボタンをクリック

### 商品を編集する

1. 商品一覧から編集したい商品の **編集** ボタンをクリック
2. 情報を修正
3. **更新** ボタンをクリック

### 商品を削除する

1. 商品一覧から削除したい商品の **削除** ボタンをクリック
2. 確認ダイアログで **OK** をクリック

**注意**: 削除された商品は「在庫切れ」として扱われ、サイトには表示されなくなります。

### 画像のアップロード

1. 商品編集画面で **画像を選択** ボタンをクリック
2. 画像ファイルを選択（JPEG、PNG、GIF、WebP対応、最大5MB）
3. 自動的にアップロードされます
4. アップロード後、画像URLが表示されます

---

## 注文管理

### 注文一覧を見る

1. サイドメニュー → **注文管理** をクリック
2. 全注文が一覧表示されます

### 注文ステータスの種類

| ステータス | 説明 |
|------------|------|
| pending | 支払い待ち |
| paid | 支払い完了 |
| processing | 処理中（Alibabaへ発注中） |
| shipped | 発送済み |
| delivered | 配達完了 |
| cancelled | キャンセル |

### 注文の処理フロー

#### 1. 新規注文を受ける

- 顧客が注文すると「pending」ステータスで登録されます
- 注文確認メールが自動送信されます

#### 2. 決済確認

- Stripeで決済が完了すると自動的に「paid」に変わります
- Cloudflare Workers が自動処理します

#### 3. Alibabaへ発注

1. 注文詳細を開く
2. **Alibabaで発注** ボタンをクリック
3. Alibabaのサイトで実際に発注
4. 発注完了後、Alibaba注文IDを入力
5. ステータスを「processing」に変更
6. **更新** ボタンをクリック

#### 4. 発送処理

1. Alibabaから追跡番号を受け取る
2. 注文詳細で追跡番号を入力
3. ステータスを「shipped」に変更
4. **発送通知メールを送信** ボタンをクリック
5. 顧客に自動的にメールが送信されます

#### 5. 配達完了

顧客が商品を受け取ったら、ステータスを「delivered」に変更します。

---

## Alibabaドロップシッピング手順

### 事前準備

1. Alibabaアカウントを作成
2. ドロップシッピング対応サプライヤーを見つける
3. 商品ページのURLを控える

### 発注手順

1. **商品を登録**:
   - 管理画面で商品を追加
   - Alibaba URLを入力
   - 仕入れ価格を記録（利益計算用）

2. **注文を受ける**:
   - 顧客からの注文を確認
   - 決済完了を確認

3. **Alibabaで発注**:
   - Alibabaにログイン
   - 商品ページから発注
   - 配送先: 顧客の住所を入力
   - 発注完了後、注文番号を控える

4. **システムに記録**:
   - 管理画面で注文詳細を開く
   - Alibaba注文IDを入力
   - ステータスを「processing」に変更

5. **追跡番号を登録**:
   - Alibabaから追跡番号を受け取る
   - 管理画面で追跡番号を入力
   - 発送通知メールを送信

---

## よくある質問

### Q1. パスワードを忘れてしまった

**A**: 現在、パスワードリセット機能はありません。データベースに直接アクセスして変更する必要があります。

```sql
-- D1データベースで実行
UPDATE admins 
SET password_hash = '<新しいハッシュ値>' 
WHERE email = 'admin@smartpolice.net';
```

### Q2. 商品画像が表示されない

**A**: 以下を確認してください：
1. R2バケットが正しく設定されているか
2. 画像ファイルがアップロードされているか
3. 画像URLが正しいか

```bash
# R2バケットの確認
npx wrangler r2 bucket list
```

### Q3. 注文確認メールが送信されない

**A**: Resendの設定を確認してください：
1. Resend APIキーが正しいか
2. 送信元アドレスが認証済みか
3. Resendダッシュボードでログを確認

### Q4. Stripe決済が反映されない

**A**: Stripe Webhookの設定を確認してください：
1. Webhook URLが正しいか: `https://shop.smartpolice.net/api/webhooks/stripe`
2. Webhook Secretが正しいか
3. Stripeダッシュボードでイベントログを確認

### Q5. 在庫管理はどうすればいい？

**A**: ドロップシッピングのため、在庫管理は不要です。ただし、Alibabaサプライヤーの在庫状況を定期的に確認することをお勧めします。

### Q6. 利益率の計算方法は？

**A**: 
```
利益率 = (販売価格 - 仕入れ価格) / 販売価格 × 100%

例:
販売価格: 8,900円
仕入れ価格: 3,500円
利益: 5,400円
利益率: 60.7%
```

### Q7. 商品を一括で追加できる？

**A**: 現在、一括追加機能はありません。今後のアップデートで実装予定です。

---

## セキュリティのベストプラクティス

### 1. パスワードを強力にする

- 最低12文字以上
- 大文字・小文字・数字・記号を組み合わせる
- 定期的に変更する

### 2. IPアドレス制限

Cloudflare Firewall Rulesで管理画面へのアクセスを制限：

```
URI Path contains "/admin" AND IP Address not in {あなたのIP}
→ Block
```

### 3. 定期的なバックアップ

```bash
# D1データベースのバックアップ
npx wrangler d1 export smartpolice-shop-db --output=backup.sql
```

---

## サポート

問題が解決しない場合は、以下にお問い合わせください：

📧 **メール**: admin@smartpolice.net  
🌐 **ウェブサイト**: https://shop.smartpolice.net

---

**🛡️ 守る力を、あなたの手に。**
